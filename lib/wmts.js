// Generated by LiveScript 1.2.0
var request, cheerio, out$ = typeof exports != 'undefined' && exports || this, split$ = ''.split;
request = require('request');
cheerio = require('cheerio');
out$.avaliableTitles = avaliableTitles;
function avaliableTitles(url, done){
  return request(url, function(err, res, body){
    var c, get, layers, result;
    if (err) {
      done(err, {
        count: 0,
        titles: {}
      });
    }
    c = cheerio.load(body, {
      xmlMode: true
    });
    get = function(o, q){
      return c(o).children(q);
    };
    layers = c('Contents').find('Layer');
    result = {
      count: layers.length,
      titles: {}
    };
    layers.each(function(idx){
      var id, name, format, url, lowerCorner, upperCorner, ref$, llon, llat, ulon, ulat;
      id = get(this, "ows\\:Identifier").text();
      name = get(this, "ows\\:Title").text();
      format = get(this, 'Format').text().replace('image/', '');
      url = get(this, 'ResourceURL').attr('template');
      lowerCorner = get(this, 'ows\\:WGS84BoundingBox').children('ows\\:LowerCorner').text();
      upperCorner = get(this, 'ows\\:WGS84BoundingBox').children('ows\\:UpperCorner').text();
      ref$ = split$.call(lowerCorner, ' '), llon = ref$[0], llat = ref$[1];
      ref$ = split$.call(upperCorner, ' '), ulon = ref$[0], ulat = ref$[1];
      return result['titles'][id] = {
        id: id,
        name: name,
        format: format,
        url: url,
        lowerCorner: {
          long: llon,
          lat: llat
        },
        upperCorner: {
          long: ulon,
          lat: ulat
        }
      };
    });
    return done(err, result);
  });
}